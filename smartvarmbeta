<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Varmekalkulator</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="VarmeCalc">
    <meta name="theme-color" content="#0f172a">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; 
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .card { background: white; border-radius: 1.5rem; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .gradient-header { background: linear-gradient(135deg, #0f172a 0%, #334155 100%); }
        input[type="range"] { accent-color: #3b82f6; }
        
        /* PWA Installasjons-hint animasjon */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }
        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }
    </style>
</head>
<body class="p-4 md:p-8 pb-24">

    <div class="max-w-2xl mx-auto card overflow-hidden border border-gray-100">
        <!-- Header -->
        <header class="gradient-header p-6 text-white text-center">
            <h1 class="text-2xl font-bold">Smart Varmekalkulator</h1>
            <p class="text-sm opacity-90 text-slate-300 uppercase tracking-wider font-semibold mt-1">Soverom & Oppvarming</p>
        </header>

        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Venstre kolonne: Innstillinger -->
            <div class="space-y-6">
                <section>
                    <h3 class="font-bold text-gray-800 border-b pb-2 mb-3 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                        Boligstandard
                    </h3>
                    <div>
                        <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Byggeår / Isolasjon</label>
                        <select id="insulationSelect" onchange="calculate()" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-sm text-gray-700 font-medium cursor-pointer">
                            <option value="1.8">Gammelt (Før 1980)</option>
                            <option value="1.2" selected>Middels (1980-2010)</option>
                            <option value="0.7">Moderne (TEK10/17)</option>
                            <option value="0.4">Passivhus</option>
                        </select>
                    </div>
                </section>
                
                <section class="space-y-4">
                    <h3 class="font-bold text-gray-800 border-b pb-2 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                        Rom & Klima
                    </h3>
                    <div>
                        <label class="flex justify-between text-sm font-semibold text-gray-600 mb-1">
                            Romstørrelse <span><span id="m2Val" class="text-blue-600">15</span> m²</span>
                        </label>
                        <input type="range" id="m2Input" min="5" max="40" value="15" oninput="calculate()" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Ute (°C)</label>
                            <input type="number" id="outTempInput" value="0" oninput="calculate()" class="w-full p-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm text-gray-700">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Inne (°C)</label>
                            <input type="number" id="inTempInput" value="20" oninput="calculate()" class="w-full p-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm text-gray-700">
                        </div>
                    </div>

                    <div class="flex items-center justify-between bg-emerald-50 p-4 rounded-2xl border border-emerald-100">
                        <div class="flex flex-col">
                            <span class="text-sm font-bold text-emerald-800">Nattsenking</span>
                            <span class="text-[10px] text-emerald-600 font-medium uppercase tracking-tight">-4°C i 8 timer</span>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="nightSetback" onchange="calculate()" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
                        </label>
                    </div>
                </section>

                <section class="pt-2">
                    <h3 class="font-bold text-gray-800 border-b pb-2 mb-3 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                        Strøm & Effekt
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Ovn (Watt)</label>
                            <input type="number" id="wattInput" value="1000" oninput="calculate()" class="w-full p-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm text-gray-700">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Pris (kr/kWh)</label>
                            <input type="number" id="priceInput" value="1.80" step="0.1" oninput="calculate()" class="w-full p-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm text-gray-700">
                        </div>
                    </div>
                </section>
            </div>

            <!-- Høyre kolonne: Resultater -->
            <div class="flex flex-col space-y-4">
                <div class="bg-slate-900 rounded-[2rem] p-8 flex-1 flex flex-col justify-center text-white relative overflow-hidden shadow-inner">
                    <span class="text-slate-400 text-xs font-black uppercase tracking-widest mb-2">Kostnad per døgn</span>
                    <div class="text-6xl font-black text-white mb-2 tracking-tighter">
                        <span id="dailyCost">0.00</span><span class="text-xl ml-1 text-slate-500 font-medium">kr</span>
                    </div>
                    
                    <div id="statusBadge" class="inline-block self-start px-3 py-1 rounded-full text-[10px] font-bold uppercase mb-8 border transition-colors duration-300">
                        Beregner...
                    </div>
                    
                    <div class="w-full space-y-4 text-sm border-t border-slate-800 pt-8">
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400">Behov:</span>
                            <span id="heatLoss" class="font-bold text-white text-base">0 W</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400">Spart (natt):</span>
                            <span id="savingVal" class="font-bold text-emerald-400 text-base">0.00 kr</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400">Driftstid:</span>
                            <span id="dutyCycle" class="font-bold text-blue-400 text-base">0%</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white border border-gray-100 p-5 rounded-3xl shadow-sm text-center">
                        <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-1">Uke</p>
                        <p id="weeklyCost" class="text-2xl font-black text-gray-800">0 kr</p>
                    </div>
                    <div class="bg-white border border-gray-100 p-5 rounded-3xl shadow-sm text-center">
                        <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-1">Mnd</p>
                        <p id="monthlyCost" class="text-2xl font-black text-gray-800">0 kr</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PWA Installasjons-instruks (vises kun på mobil) -->
    <div id="pwaNotice" class="fixed bottom-6 left-4 right-4 bg-white p-4 rounded-2xl shadow-2xl border border-blue-100 hidden z-50 animate-bounce-slow">
        <div class="flex items-center gap-4">
            <div class="bg-blue-600 p-3 rounded-xl text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            </div>
            <div class="flex-1">
                <p class="text-sm font-bold text-gray-800">Installer som app</p>
                <p class="text-xs text-gray-500">Trykk på delingsikonet og velg "Legg til på hjemskjerm"</p>
            </div>
            <button onclick="document.getElementById('pwaNotice').remove()" class="text-gray-400">✕</button>
        </div>
    </div>

    <script>
        // --- PWA LOGIKK ---
        // Siden vi er i en simulert omgivelse, lager vi manifestet on-the-fly
        const manifest = {
            "name": "Smart Varmekalkulator",
            "short_name": "VarmeCalc",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#0f172a",
            "theme_color": "#0f172a",
            "icons": [
                {
                    "src": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIGZpbGw9IiMwZjE3MmEiLz48cG9seWdvbiBwb2ludHM9IjI3Ny4zIDQyLjcgNjQuMSAyOTguNyAyNTYgMjk4LjcgMjM0LjcgNDY5LjMgNDQ3LjkgMjEzLjMgMjU2IDIxMy4zIDI3Ny4zIDQyLjciIGZpbGw9IiMzYjgyZjYiLz48L3N2Zz4=",
                    "sizes": "512x512",
                    "type": "image/png"
                }
            ]
        };

        const stringManifest = JSON.stringify(manifest);
        const blob = new Blob([stringManifest], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestURL;
        document.head.appendChild(link);

        // Service Worker registrering
        if ('serviceWorker' in navigator) {
            const swCode = `
                self.addEventListener('install', (e) => {
                    self.skipWaiting();
                });
                self.addEventListener('fetch', (e) => {
                    e.respondWith(fetch(e.request).catch(() => caches.match(e.request)));
                });
            `;
            const swBlob = new Blob([swCode], {type: 'text/javascript'});
            const swURL = URL.createObjectURL(swBlob);
            navigator.serviceWorker.register(swURL).catch(() => {});
        }

        // Vis installasjons-hint på iOS hvis den ikke er lagret ennå
        if (window.navigator.standalone === false) {
            setTimeout(() => {
                document.getElementById('pwaNotice').classList.remove('hidden');
            }, 3000);
        }

        // --- KALKULATOR LOGIKK ---
        function calculate() {
            const m2 = parseFloat(document.getElementById('m2Input').value);
            const outTemp = parseFloat(document.getElementById('outTempInput').value);
            const inTemp = parseFloat(document.getElementById('inTempInput').value);
            const watt = parseFloat(document.getElementById('wattInput').value) || 0;
            const price = parseFloat(document.getElementById('priceInput').value) || 0;
            const isolationFactor = parseFloat(document.getElementById('insulationSelect').value);
            const useNightSetback = document.getElementById('nightSetback').checked;

            document.getElementById('m2Val').textContent = m2;

            const deltaT = Math.max(0, inTemp - outTemp);
            const deltaTNight = Math.max(0, (inTemp - 4) - outTemp);

            const requiredPowerDay = (m2 * isolationFactor * deltaT) * 0.55;
            const requiredPowerNight = (m2 * isolationFactor * deltaTNight) * 0.55;

            let kwhPerDay = 0;
            let saving = 0;

            if (useNightSetback) {
                const dayEnergy = (Math.min(watt, requiredPowerDay) / 1000) * 16;
                const nightEnergy = (Math.min(watt, requiredPowerNight) / 1000) * 8;
                kwhPerDay = dayEnergy + nightEnergy;
                const energyWithoutSetback = (Math.min(watt, requiredPowerDay) / 1000) * 24;
                saving = (energyWithoutSetback - kwhPerDay) * price;
            } else {
                kwhPerDay = (Math.min(watt, requiredPowerDay) / 1000) * 24;
            }

            const avgRequiredPower = useNightSetback ? (requiredPowerDay * 16 + requiredPowerNight * 8) / 24 : requiredPowerDay;
            const dutyCycle = watt > 0 ? Math.min(1, avgRequiredPower / watt) : 0;

            const dailyCost = kwhPerDay * price;
            document.getElementById('dailyCost').textContent = dailyCost.toFixed(2);
            document.getElementById('heatLoss').textContent = Math.round(requiredPowerDay) + " W";
            document.getElementById('dutyCycle').textContent = Math.round(dutyCycle * 100) + "%";
            document.getElementById('savingVal').textContent = saving.toFixed(2) + " kr";
            
            document.getElementById('weeklyCost').textContent = Math.round(dailyCost * 7) + " kr";
            document.getElementById('monthlyCost').textContent = Math.round(dailyCost * 30.4) + " kr";

            const status = document.getElementById('statusBadge');
            if (dutyCycle >= 1) {
                status.textContent = "Ovnen går kontinuerlig";
                status.className = "inline-block self-start px-3 py-1 rounded-full text-[10px] font-bold uppercase mb-8 bg-red-900/30 text-red-200 border-red-700/50";
            } else if (dutyCycle > 0.6) {
                status.textContent = "Høy belastning";
                status.className = "inline-block self-start px-3 py-1 rounded-full text-[10px] font-bold uppercase mb-8 bg-orange-900/30 text-orange-200 border-orange-700/50";
            } else {
                status.textContent = "Effektiv oppvarming";
                status.className = "inline-block self-start px-3 py-1 rounded-full text-[10px] font-bold uppercase mb-8 bg-emerald-900/30 text-emerald-300 border-emerald-700/50";
            }
        }

        window.onload = calculate;
    </script>
</body>
</html>
