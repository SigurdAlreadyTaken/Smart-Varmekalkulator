<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Varmekalkulator</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="VarmeCalc">
    <meta name="theme-color" content="#0f172a">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; 
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }

        .card { 
            background: white; 
            border-radius: 2rem; 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); 
        }

        .gradient-header { 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); 
        }

        input[type="range"] { 
            accent-color: #3b82f6; 
        }

        .source-pill {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
            animation: slideUp 0.5s ease-out forwards;
        }

        .safe-area-inset-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex flex-col items-center">

    <div class="w-full max-w-md card overflow-hidden border border-gray-100 flex flex-col">
        <!-- Header -->
        <header class="gradient-header p-8 text-white text-center">
            <h1 class="text-2xl font-bold tracking-tight">Varmekalkulator</h1>
            <p class="text-xs opacity-70 uppercase tracking-widest font-semibold mt-1 text-blue-400">Smart energi-estimat</p>
            <div class="mt-4 flex justify-center">
                <span class="text-[9px] uppercase tracking-wider font-bold text-slate-400 border border-slate-700 px-3 py-1 rounded-full bg-slate-800/30">
                    Beregning for kun ett rom
                </span>
            </div>
        </header>

        <div class="p-6 space-y-8 flex-1">
            
            <!-- Valg av Varmekilde -->
            <section>
                <div class="flex items-center gap-2 mb-4">
                    <div class="p-2 bg-orange-50 rounded-lg text-orange-600">
                        <!-- Oppdatert ikon: To bølgete striper -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M8 5c1 1 1 3 0 4s-1 3 0 4 1 3 0 4"></path>
                            <path d="M16 5c1 1 1 3 0 4s-1 3 0 4 1 3 0 4"></path>
                        </svg>
                    </div>
                    <h3 class="font-bold text-gray-800">Varmekilde</h3>
                </div>
                <div class="grid grid-cols-2 gap-2 p-1 bg-gray-100 rounded-2xl">
                    <button onclick="setSource('panel')" id="btnPanel" class="source-pill py-3 px-4 rounded-xl text-sm font-bold flex items-center justify-center gap-2 bg-white text-blue-600 shadow-sm">
                        Veggovn
                    </button>
                    <button onclick="setSource('cable')" id="btnCable" class="source-pill py-3 px-4 rounded-xl text-sm font-bold flex items-center justify-center gap-2 text-gray-500">
                        Varmekabel
                    </button>
                </div>
                <input type="hidden" id="heatSource" value="panel">
            </section>

            <!-- Boligstandard -->
            <section>
                <div class="flex items-center gap-2 mb-4">
                    <div class="p-2 bg-blue-50 rounded-lg text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    </div>
                    <h3 class="font-bold text-gray-800">Boligstandard</h3>
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-2 tracking-wide">Byggeår / Isolasjon</label>
                    <select id="insulationSelect" onchange="calculate()" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none text-sm text-gray-700 font-semibold cursor-pointer appearance-none">
                        <option value="1.8">Gammelt (Før 1980)</option>
                        <option value="1.2" selected>Middels (1980-2010)</option>
                        <option value="0.7">Moderne (TEK10/17)</option>
                        <option value="0.4">Passivhus</option>
                    </select>
                </div>
            </section>
            
            <!-- Rom & Klima -->
            <section class="space-y-5">
                <div class="flex items-center gap-2 mb-2">
                    <div class="p-2 bg-blue-50 rounded-lg text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    </div>
                    <h3 class="font-bold text-gray-800">Rom & Klima</h3>
                </div>
                
                <div>
                    <div class="flex justify-between text-sm font-bold text-gray-600 mb-3">
                        <span>Romstørrelse</span>
                        <span class="text-blue-600"><span id="m2Val">15</span> m²</span>
                    </div>
                    <input type="range" id="m2Input" min="5" max="60" value="15" oninput="calculate()" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-3 rounded-2xl border border-gray-100 text-center">
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1">Utetemp (°C)</label>
                        <input type="number" id="outTempInput" value="0" oninput="calculate()" class="w-full bg-transparent font-bold text-gray-800 outline-none text-center">
                    </div>
                    <div class="bg-gray-50 p-3 rounded-2xl border border-gray-100 text-center">
                        <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1">Innetemp (°C)</label>
                        <input type="number" id="inTempInput" value="21" oninput="calculate()" class="w-full bg-transparent font-bold text-gray-800 outline-none text-center">
                    </div>
                </div>

                <!-- Nattsenking Toggle -->
                <div id="nightSetbackContainer" class="flex items-center justify-between bg-emerald-50/50 p-4 rounded-2xl border border-emerald-100/50 transition-all duration-300">
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-emerald-900">Nattsenking</span>
                        <span id="nightNote" class="text-[10px] text-emerald-600 font-medium">-4°C i 8 timer</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="nightSetback" onchange="calculate()" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
                    </label>
                </div>
            </section>

            <!-- Innstillinger & Pris -->
            <section class="space-y-6">
                <div class="flex items-center gap-2 mb-2">
                    <div class="p-2 bg-blue-50 rounded-lg text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                    </div>
                    <h3 class="font-bold text-gray-800">Effekt & Strømpris</h3>
                </div>

                <div>
                    <div class="flex justify-between text-sm font-bold text-gray-600 mb-3">
                        <span class="max-w-[180px]">Strømpris m/nettleie</span>
                        <span class="text-blue-600"><span id="priceVal">1.80</span> kr/kWh</span>
                    </div>
                    <input type="range" id="priceInput" min="0.5" max="10" step="0.1" value="1.8" oninput="calculate()" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-gray-400 uppercase mb-1 tracking-wide">Ovnens effekt (Watt)</label>
                    <input type="number" id="wattInput" value="1000" oninput="calculate()" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl font-bold text-gray-700 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
            </section>

            <!-- Resultat Panel -->
            <div class="bg-slate-900 rounded-[2.5rem] p-8 text-white relative overflow-hidden shadow-2xl mt-4">
                <span class="text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] mb-2 block">Døgnpris</span>
                <div class="flex items-baseline gap-1 mb-6">
                    <span id="dailyCost" class="text-5xl font-black tracking-tighter">0.00</span>
                    <span class="text-lg text-slate-500 font-bold">kr</span>
                </div>
                
                <div class="space-y-4 border-t border-slate-800 pt-6">
                    <div class="flex justify-between items-center text-xs">
                        <span class="text-slate-400 font-medium text-[11px]">Behov for oppvarming:</span>
                        <span id="heatLoss" class="font-bold text-white">0 W</span>
                    </div>
                    <div class="flex justify-between items-center text-xs">
                        <span class="text-slate-400 font-medium text-[11px]">Driftstid (termostat):</span>
                        <span id="dutyCycle" class="font-bold text-blue-400">0%</span>
                    </div>
                    <div class="flex justify-between items-center text-xs">
                        <span class="text-slate-400 font-medium text-[11px]">Effekt av kilde:</span>
                        <span id="sourceBonus" class="font-bold text-amber-400">Normal</span>
                    </div>
                </div>

                <!-- Status Indikator -->
                <div id="statusBadge" class="mt-6 text-[10px] font-bold uppercase py-2 px-4 rounded-full border border-slate-700 bg-slate-800/50 text-center tracking-widest transition-all">
                    Beregner...
                </div>
            </div>

            <!-- Oppsummering Kort -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50/50 p-4 rounded-3xl border border-blue-50 text-center shadow-sm">
                    <p class="text-[9px] text-blue-400 font-bold uppercase mb-1 tracking-tighter">Ukespris</p>
                    <p id="weeklyCost" class="text-xl font-black text-slate-800">0 kr</p>
                </div>
                <div class="bg-indigo-50/50 p-4 rounded-3xl border border-indigo-50 text-center shadow-sm">
                    <p class="text-[9px] text-indigo-400 font-bold uppercase mb-1 tracking-tighter">Månedspris</p>
                    <p id="monthlyCost" class="text-xl font-black text-slate-800">0 kr</p>
                </div>
            </div>

            <!-- Informasjonsseksjon -->
            <section class="bg-white border border-gray-100 rounded-[2rem] p-6 space-y-4 shadow-sm">
                <div class="flex items-center gap-2 mb-2">
                    <div class="p-2 bg-amber-50 rounded-lg text-amber-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </div>
                    <h4 class="font-bold text-sm text-gray-800 tracking-tight">Forskjeller i bruk</h4>
                </div>
                
                <div class="space-y-3 text-[11px] leading-relaxed text-gray-600">
                    <div class="flex gap-3">
                        <div class="w-1 h-auto bg-blue-100 rounded-full flex-shrink-0"></div>
                        <p><span class="font-bold text-gray-800">Komfort:</span> Varmekabler gir jevnere varme fra gulvet. Dette gjør at man ofte kan senke innetemperaturen med 1-2 grader uten tap av komfort.</p>
                    </div>
                    <div class="flex gap-3">
                        <div class="w-1 h-auto bg-blue-100 rounded-full flex-shrink-0"></div>
                        <p><span class="font-bold text-gray-800">Responstid:</span> Veggovner varmer opp luften umiddelbart. Varmekabler har lang oppvarmingstid (treghet), som gjør dem mindre egnet for hyppig nattsenking.</p>
                    </div>
                    <div class="flex gap-3">
                        <div class="w-1 h-auto bg-blue-100 rounded-full flex-shrink-0"></div>
                        <p><span class="font-bold text-gray-800">Sirkulasjon:</span> Veggovner skaper mer luftsirkulasjon (konveksjon), mens varmekabler gir en mer stabil luft uten samme grad av støvspredning.</p>
                    </div>
                </div>
            </section>
        </div>

        <footer class="p-8 text-[10px] text-gray-400 text-center leading-relaxed bg-gray-50/50">
            Estimert forbruk basert på isolasjonsfaktor og temperaturdifferanse.<br>
            Faktiske verdier kan variere med vind og solinnstråling.
        </footer>
    </div>

    <!-- PWA Installasjons-instruks -->
    <div id="pwaNotice" class="fixed bottom-6 left-4 right-4 bg-white p-5 rounded-3xl shadow-2xl border border-blue-100 hidden z-50 animate-slide-up safe-area-inset-bottom">
        <div class="flex items-center gap-4">
            <div class="bg-blue-600 p-3 rounded-2xl text-white shadow-lg shadow-blue-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            </div>
            <div class="flex-1">
                <p class="text-sm font-bold text-gray-800">Installer appen</p>
                <p class="text-[11px] text-gray-500">Trykk på del-ikonet og velg <span class="font-bold text-gray-700">"Legg til på hjemskjerm"</span></p>
            </div>
            <button onclick="document.getElementById('pwaNotice').remove()" class="bg-gray-100 p-2 rounded-full text-gray-400">✕</button>
        </div>
    </div>

    <script>
        // --- PWA SETUP ---
        const manifest = {
            "name": "Smart Varmekalkulator",
            "short_name": "VarmeCalc",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#0f172a",
            "theme_color": "#0f172a",
            "icons": [{
                "src": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIGZpbGw9IiMwZjE3MmEiLz48cG9seWdvbiBwb2ludHM9IjI3Ny4zIDQyLjcgNjQuMSAyOTguNyAyNTYgMjk4LjcgMjM0LjcgNDY5LjMgNDQ3LjkgMjEzLjMgMjU2IDIxMy4zIDI3Ny4zIDQyLjciIGZpbGw9IiMzYjgyZjYiLz48L3N2Zz4=",
                "sizes": "512x512",
                "type": "image/png"
            }]
        };

        const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestURL;
        document.head.appendChild(link);

        if ('serviceWorker' in navigator) {
            const swCode = `self.addEventListener('fetch', (e) => e.respondWith(fetch(e.request)));`;
            const swBlob = new Blob([swCode], {type: 'text/javascript'});
            const swURL = URL.createObjectURL(swBlob);
            navigator.serviceWorker.register(swURL).catch(() => {});
        }

        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isStandalone = window.navigator.standalone === true;
        if (isIOS && !isStandalone) {
            setTimeout(() => {
                const notice = document.getElementById('pwaNotice');
                if(notice) notice.classList.remove('hidden');
            }, 3000);
        }

        // --- VARMEKILDE LOGIKK ---
        function setSource(type) {
            document.getElementById('heatSource').value = type;
            const btnPanel = document.getElementById('btnPanel');
            const btnCable = document.getElementById('btnCable');
            const nightContainer = document.getElementById('nightSetbackContainer');
            const nightCheckbox = document.getElementById('nightSetback');
            const nightNote = document.getElementById('nightNote');

            if (type === 'panel') {
                btnPanel.className = "source-pill py-3 px-4 rounded-xl text-sm font-bold flex items-center justify-center gap-2 bg-white text-blue-600 shadow-sm";
                btnCable.className = "source-pill py-3 px-4 rounded-xl text-sm font-bold flex items-center justify-center gap-2 text-gray-500";
                
                nightContainer.style.opacity = "1";
                nightContainer.style.pointerEvents = "auto";
                nightNote.textContent = "-4°C i 8 timer";
            } else {
                btnCable.className = "source-pill py-3 px-4 rounded-xl text-sm font-bold flex items-center justify-center gap-2 bg-white text-blue-600 shadow-sm";
                btnPanel.className = "source-pill py-3 px-4 rounded-xl text-sm font-bold flex items-center justify-center gap-2 text-gray-500";
                
                nightContainer.style.opacity = "0.4";
                nightContainer.style.pointerEvents = "none";
                nightCheckbox.checked = false;
                nightNote.textContent = "Ikke anbefalt (tregt)";
            }
            calculate();
        }

        // --- KALKULERING ---
        function calculate() {
            const m2 = parseFloat(document.getElementById('m2Input').value);
            const outTemp = parseFloat(document.getElementById('outTempInput').value);
            let inTemp = parseFloat(document.getElementById('inTempInput').value);
            const watt = parseFloat(document.getElementById('wattInput').value) || 0;
            const price = parseFloat(document.getElementById('priceInput').value);
            const isolationFactor = parseFloat(document.getElementById('insulationSelect').value);
            const useNightSetback = document.getElementById('nightSetback').checked;
            const source = document.getElementById('heatSource').value;

            document.getElementById('m2Val').textContent = m2;
            document.getElementById('priceVal').textContent = price.toFixed(2);

            const bonusDisplay = document.getElementById('sourceBonus');
            if (source === 'cable') {
                inTemp -= 2; 
                bonusDisplay.textContent = "Sparer 2°C";
                bonusDisplay.className = "font-bold text-emerald-400";
            } else {
                bonusDisplay.textContent = "Normal";
                bonusDisplay.className = "font-bold text-amber-400";
            }

            const deltaT = Math.max(0, inTemp - outTemp);
            const deltaTNight = Math.max(0, (inTemp - 4) - outTemp);

            const requiredPowerDay = (m2 * isolationFactor * deltaT) * 0.55;
            const requiredPowerNight = (m2 * isolationFactor * deltaTNight) * 0.55;

            let kwhPerDay = 0;

            if (useNightSetback) {
                const dayEnergy = (Math.min(watt, requiredPowerDay) / 1000) * 16;
                const nightEnergy = (Math.min(watt, requiredPowerNight) / 1000) * 8;
                kwhPerDay = dayEnergy + nightEnergy;
            } else {
                kwhPerDay = (Math.min(watt, requiredPowerDay) / 1000) * 24;
            }

            const dailyCost = kwhPerDay * price;
            const avgRequiredPower = useNightSetback ? (requiredPowerDay * 16 + requiredPowerNight * 8) / 24 : requiredPowerDay;
            const dutyCycle = watt > 0 ? Math.min(1, avgRequiredPower / watt) : 0;

            document.getElementById('dailyCost').textContent = dailyCost.toFixed(2);
            document.getElementById('heatLoss').textContent = Math.round(requiredPowerDay) + " W";
            document.getElementById('dutyCycle').textContent = Math.round(dutyCycle * 100) + "%";
            document.getElementById('weeklyCost').textContent = Math.round(dailyCost * 7) + " kr";
            document.getElementById('monthlyCost').textContent = Math.round(dailyCost * 30.4) + " kr";

            const status = document.getElementById('statusBadge');
            if (dutyCycle >= 0.99 && watt > 0) {
                status.textContent = "Ovn for liten for temp";
                status.className = "mt-6 text-[10px] font-bold uppercase py-2 px-4 rounded-full border border-red-700 bg-red-900/30 text-red-200 text-center tracking-widest";
            } else if (dutyCycle > 0.6) {
                status.textContent = "Høy belastning";
                status.className = "mt-6 text-[10px] font-bold uppercase py-2 px-4 rounded-full border border-orange-700 bg-orange-900/30 text-orange-200 text-center tracking-widest";
            } else {
                status.textContent = "Optimal drift";
                status.className = "mt-6 text-[10px] font-bold uppercase py-2 px-4 rounded-full border border-emerald-700 bg-emerald-900/30 text-emerald-200 text-center tracking-widest";
            }
        }

        window.onload = calculate;
    </script>
</body>
</html>